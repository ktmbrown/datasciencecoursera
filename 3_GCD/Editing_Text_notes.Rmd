---
title: "Editing Text Variables"
author: "Katie M Brown"
date: "January 30, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Camera Data

Getting the data from the baltimore city website:

```{r}
if(!file.exists("./data")){dir.creat("./data")}
fileUrl <- 'https://data.baltimorecity.gov/api/views/dz54-2aru/rows.csv?accessType=DOWNLOAD'
download.file(fileUrl, destfile = './data/cameras.csv',method = 'curl')
cameraData <- read.csv('./data/cameras.csv')
names(cameraData)
```

Changing names to all lower case

```{r}
tolower(names(cameraData))
names(cameraData)
```

## strsplit() 
Good for auto splitting variable names
parameters are: x = vector, split = character vector to use for splitting

```{r}
splitNames <- strsplit(names(cameraData),'\\.')
splitNames[[5]]
splitNames[[6]][2]
```

## List review
Sidenote on lists
```{r}
myList <- list(letters = c("a","b","c"),numbers = 1:3, matrix(1:25,ncol=5))
head(myList)
myList[1]
myList$letters
myList[[1]]
```

## Fixing character Vectors
sapply() applies a function to each element in a vector or list
important parameters: x = data, fun = function to be applied

```{r}
splitNames[[6]][1]

firstElement <- function(x){x[1]}
# this returns a vector instead of a list because we are looking at the first element
# in each item in the list
sapply(splitNames,firstElement)

# whereas before, we would get a list when we printed splitNames
splitNames
```

#------------------------------------------------------------------------------#
# Peer review data

Getting the data
```{r}

fileUrl1 <- 'https://raw.githubusercontent.com/jtleek/modules/master/03_GettingData/04_01_editingTextVariables/data/reviews.csv'
fileUrl2 <- 'https://raw.githubusercontent.com/jtleek/modules/master/03_GettingData/04_01_editingTextVariables/data/solutions.csv'
download.file(fileUrl1, destfile='./data/reviews.csv',method = 'curl')
download.file(fileUrl2, destfile = './data/solutions.csv', method = 'curl')
reviews <- read.csv('./data/reviews.csv')
solutions <- read.csv('./data/solutions.csv')
head(reviews,2)
head(solutions,2)
```

## sub()
Removing underscore(_) from names:
```{r}
names(reviews) <- sub("_","",names(reviews))
names(reviews)

names(solutions) <- sub("_","",names(solutions))
names(solutions)
```

## gsub()
sub removes FIRST character
```{r}
testname <- 'this_is_a_test'
sub("_","",testname)
```

gsub does all
```{r}
gsub("_","",testname)
```

## grep()

grep:  returns a vector of the indices of the elements of x that yielded a match
```{r}
grep("Alameda", cameraData$intersection)
```

returns integer(0) when match not found
```{r}
grep("JeffStreet", cameraData$intersection)
```

grepl: returns a logical vector (match or not for each element of x).
```{r}
table(grepl("Alameda", cameraData$intersection))
```

grep with value=TRUE returns a vector of the values of the elements of x that yield a match
```{r}
grep("Alameda", cameraData$intersection, value = TRUE)
```

# stringr package

```{r}
library(stringr)
nchar("Jeffrey Leek")
substr("Jeffrey Leek", 1, 7)
paste("Jeffrey","Leek")
paste0("Jeffrey","Leek")
str_trim("Jeff                  ")
str_trim("           Jeff          ")
str_trim("     Jeff     Leek    ") #doesn't trim inner spaces
str_trim("\tJeff Leek \t") #whitespace is trimmed
str_trim("\rJeff Leek \r") #whitespace is trimmed
str_trim("\nJeff Leek \n") #whitespace is trimmed
```

#------------------------------------------------------------------------------#

# Additional Notes

* Names of variables should be:
      + All lower case when possible
      + Descriptive (Diagnosis vs Dx)
      + not duplicated
      + Not have underscores or dots or white spaces
      
* Variable with character values
      + Should usually be made into factor variables
      + Should be descriptive (use TRUE/FALSE instead of 0/1 and Male/Female instead of M/F)